#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define MAX[100]    // the maximum contact list size

typedef struct
{
    char name[100];
    char phones[5][15];
    int phoneCount;
    char emails[5][50];
    int emailCount;
    char address[100];
}Contact;
Contact list[MAX];

int count =0;
//=====================================================================
void showContacts() 
{
    if (count == 0){
        printf("No contacts.\n");
        return;
    }

    for(int i = 0; i<count; i++)
    {
        printf("\n[%d] %s\n", i, list[i].name);
        printf(" Address: %s\n", list[i].address);

        printf(" Phones:\n");
        for (int j =0; j <list[i].phoneCount; j++)        printf("  - %s\n", list[i].phones[j]);

        printf(" Emails:\n");

        for (int j =0; j <list[i].emailCount; j++)        printf("  - %s\n", list[i].emails[j]);
    }
}
//============================================================================
void deleteContact() 
{
    int x;
    printf("Enter index to delete: ");
    scanf("%d", &x);
    getchar(); // remive newline character

    if (x<0 || x>=count) 
    {
        printf("Invalid index.\n");
        return;
    }

    for (int i =x; i <count-1; i++)        list[i] = list[i+1];

    count--;
    printf("Deleted.\n");
}
//===================================================================

void searchName()
{
    char q[100];
    printf("Enter name to search: ");

    fgets(q, sizeof(q), stdin);
    q[strcspn(q,"\n")] = 0;

    int found =0;
    for (int i =0; i <count; i++)
    {
        if (strstr(list[i].name, q))
        {
            printf(" Name: %s\n", list[i].name);
            printf(" Address: %s\n", list[i].address);
            found =1;
        }
    }

    if (found ==0)     printf("No match.\n");
}
//==========================================================================

void addContact()
{
    Contact c;
    if (count >= MAX)
    {
        printf("Contact list is full!\n");
        return;
    }

    printf("Enter name: ");  //take input name
    fgets(c.name, sizeof(c.name), stdin);
    c.name[strcspn(c.name, "\n")] = 0;  

    printf("Enter address: ");  //take input address
    fgets(c.address, sizeof(c.address), stdin);
    c.address[strcspn(c.address, "\n")] = 0;

    //---------- Phones -------------------------------------------------------------------
    printf("How many phone numbers?(max 5): ");  //multiple phone numbers
    scanf("%d", &c.phoneCount);
    getchar();

    if (c.phoneCount > 5)       c.phoneCount =5;

    for (int i =0; i <c.phoneCount; i++)
    {
        printf(" Phone %d: ", i+1);
        fgets(c.phones[i], sizeof(c.phones[i]), stdin);
        c.phones[i][strcspn(c.phones[i], "\n")] = 0;  //strcspn --> gives index of newline
    }

    //------- Emails----------------------------------------------------------------------------
    printf("How many emails?(max 5): ");  //multiple emails
    scanf("%d", &c.emailCount);
    getchar();

    if (c.emailCount > 5) c.emailCount = 5;

    for (int i =0; i <c.emailCount; i++)
    {
        printf(" Email %d: ", i+1);
        fgets(c.emails[i], sizeof(c.emails[i]), stdin);
        c.emails[i][strcspn(c.emails[i], "\n")] = 0;
    }
    list[count++] = c;
    printf("Contact added.\n");
}
//=========================================================================



//=================================================================================
int main() 
{
    int ch;
    while()    //creates infinite loop as many times till user exits the loop
    {  
        printf("\n1. Add Contact\n2. Show Contacts\n3. Search by Name\n4. Delete\n5. Merge Duplicates\n6. Exit\nChoice: ");
        scanf("%d", &ch);
        getchar();  //catches the newline character

        switch(ch) 
        {
            case 1: addContact();   break;
            case 2: showContacts();   break;
            case 3: searchName();   break;
            case 4: deleteContact();   break;
            case 5: mergeDuplicates();   break;
            case 6:   return 0;
            default: printf("Invalid.\n");
        }
    }
}
